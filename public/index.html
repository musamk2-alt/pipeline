<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Coin Memory</title>

    <style>
      :root{
        --text:#f3f5ff;
        --muted:#aeb3cf;
        --muted2:#7d86ad;
        --good:#6CFFB3;
        --warn:#FFD37C;
        --bad:#FF6C7A;
        --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
        --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      }
      *{ box-sizing:border-box; }
      body{
        margin:0;
        font-family:var(--sans);
        color:var(--text);
        background:
          radial-gradient(900px 600px at 15% 8%, rgba(124, 88, 255, 0.35), transparent 55%),
          radial-gradient(900px 650px at 85% 10%, rgba(0, 225, 255, 0.18), transparent 55%),
          radial-gradient(1100px 700px at 50% 120%, rgba(108, 255, 179, 0.14), transparent 60%),
          linear-gradient(180deg, #05060a, #07070b 55%, #05060a);
      }
      .wrap{ max-width:1100px; margin:0 auto; padding:28px 18px 40px; }

      .card{
        border-radius:18px;
        border:1px solid rgba(255,255,255,0.06);
        background: linear-gradient(180deg, rgba(14,15,22,0.82), rgba(10,10,16,0.6));
        box-shadow: 0 18px 50px rgba(0,0,0,0.45);
        overflow:hidden;
        margin-top:14px;
      }
      .cardHead{
        padding:14px;
        display:flex; justify-content:space-between; align-items:center; gap:12px;
        border-bottom:1px solid rgba(255,255,255,0.06);
      }
      .cardHead h2{ margin:0; font-size:14px; }
      .tag{
        font-size:11px; color:var(--muted);
        padding:6px 10px; border-radius:999px;
        border:1px solid rgba(255,255,255,0.07);
        background: rgba(0,0,0,0.18);
        font-family:var(--mono);
      }
      .cardBody{ padding:14px; }

      .hero{
        border-radius:24px;
        padding:22px 18px;
        background: linear-gradient(180deg, rgba(18,19,30,0.85), rgba(10,10,16,0.65));
        border:1px solid rgba(255,255,255,0.06);
        box-shadow: 0 20px 60px rgba(0,0,0,0.55);
        margin-top:0;
      }
      .heroRow{ display:flex; justify-content:space-between; gap:14px; flex-wrap:wrap; align-items:center; }
      .brand{ display:flex; gap:10px; align-items:center; }
      .logo{
        width:42px;height:42px;border-radius:14px;
        background: linear-gradient(135deg, rgba(124,88,255,0.95), rgba(0,225,255,0.75));
        border:1px solid rgba(255,255,255,0.10);
        box-shadow: 0 8px 30px rgba(124,88,255,0.25);
      }
      h1{ margin:0; font-size:26px; }
      .subtitle{ color:var(--muted); font-size:13px; max-width:64ch; line-height:1.45; }
      .chips{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; }
      .chip{
        padding:8px 10px; border-radius:999px;
        background: rgba(12,13,19,0.7);
        border:1px solid rgba(255,255,255,0.06);
        font-size:12px; color:var(--muted);
        display:flex; gap:8px; align-items:center;
      }
      .chip b{ color:var(--text); }
      .dot{ width:8px;height:8px;border-radius:99px; background: var(--warn); }
      .dot.ok{ background:var(--good); }
      .dot.err{ background:var(--bad); }

      .btn{
        cursor:pointer;
        border:1px solid rgba(255,255,255,0.08);
        background: rgba(15,16,25,0.65);
        color:var(--text);
        border-radius:14px;
        padding:10px 12px;
        font-size:12px;
        font-weight:650;
      }
      .btn:hover{ filter:brightness(1.1); border-color: rgba(124,88,255,0.22); }

      table{ width:100%; border-collapse:collapse; }
      th, td{
        padding:12px 10px;
        border-bottom:1px solid rgba(255,255,255,0.06);
        text-align:left;
        vertical-align:top;
        font-size:13px;
      }
      th{ color: var(--muted); font-weight:700; font-size:12px; }
      .mono{ font-family:var(--mono); }
      .muted{ color:var(--muted); }
      .small{ font-size:12px; }

      .grid{ display:grid; gap:14px; }
      .grid2{ grid-template-columns: 1.2fr 0.8fr; }
      .grid3{ grid-template-columns: 1fr 1fr 1fr; }
      @media (max-width:980px){ .grid2,.grid3{ grid-template-columns:1fr; } }

      input{
        width:100%;
        padding:12px;
        border-radius:14px;
        border:1px solid rgba(255,255,255,0.08);
        background: rgba(6,6,10,0.55);
        color:var(--text);
        font-family:var(--mono);
        font-size:12px;
      }

      /* Badges */
      .badgeWrap{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
      .badge{
        position:relative;
        display:inline-flex;
        align-items:center;
        gap:8px;
        padding:7px 10px;
        border-radius:999px;
        border:1px solid rgba(255,255,255,0.08);
        background: rgba(0,0,0,0.18);
        font-family:var(--mono);
        font-size:11px;
        cursor:default;
        transition: transform .12s ease, filter .12s ease;
      }
      .badge:hover{ transform: translateY(-1px); filter: brightness(1.12); }

      /* category colors */
      .catQuest{ border-color: rgba(0,225,255,0.22); }
      .catRarity{ border-color: rgba(255,211,124,0.28); }
      .catStreak{ border-color: rgba(124,88,255,0.30); }
      .catMemory{ border-color: rgba(108,255,179,0.20); }

      /* rarity glows */
      .rarLegendary{
        box-shadow: 0 0 0 3px rgba(124,88,255,0.10), 0 0 24px rgba(124,88,255,0.12);
      }
      .rarRare{
        box-shadow: 0 0 0 3px rgba(0,225,255,0.08);
      }

      /* locked silhouettes */
      .lockedBadge{
        opacity:0.9;
        background: rgba(0,0,0,0.10);
        border-style: dashed;
        filter: saturate(0.25) brightness(0.85);
      }
      .lockedBadge .label{
        letter-spacing:0.4px;
        opacity:0.95;
      }
      .lockedBadge .ghost{
        width:10px;height:10px;border-radius:99px;
        background: rgba(255,255,255,0.10);
        box-shadow: 0 0 0 2px rgba(255,255,255,0.04), 0 0 16px rgba(255,255,255,0.06);
      }

      /* unlock pop */
      @keyframes unlockPop{
        0%{ transform: translateY(0) scale(1); filter:brightness(1); }
        35%{ transform: translateY(-2px) scale(1.06); filter:brightness(1.25); }
        100%{ transform: translateY(0) scale(1); filter:brightness(1.05); }
      }
      .justUnlocked{
        animation: unlockPop .55s ease both;
        box-shadow: 0 0 0 3px rgba(108,255,179,0.10), 0 0 26px rgba(108,255,179,0.14) !important;
        border-color: rgba(108,255,179,0.30) !important;
      }

      /* Tooltip */
      .badge .tip{
        position:absolute;
        left:50%;
        bottom: calc(100% + 10px);
        transform: translateX(-50%);
        width: 280px;
        padding:10px 10px;
        border-radius:14px;
        border:1px solid rgba(255,255,255,0.10);
        background: rgba(10,10,16,0.90);
        color: var(--text);
        box-shadow: 0 18px 60px rgba(0,0,0,0.6);
        opacity:0;
        pointer-events:none;
        transition: opacity .12s ease, transform .12s ease;
      }
      .badge:hover .tip{
        opacity:1;
        transform: translateX(-50%) translateY(-2px);
      }
      .tip .t{ font-weight:900; font-size:12px; margin-bottom:6px; }
      .tip .d{ color:var(--muted); font-size:12px; line-height:1.4; }
      .tip .m{ margin-top:8px; color:var(--muted2); font-size:11px; font-family:var(--mono); }

      /* Progress UI */
      .progRow{ margin-bottom:14px; }
      .progTop{ display:flex; justify-content:space-between; gap:12px; margin-bottom:6px; }
      .progBar{
        height:10px;
        border-radius:999px;
        border:1px solid rgba(255,255,255,0.08);
        background: rgba(0,0,0,0.18);
        overflow:hidden;
      }
      .progFill{
        height:100%;
        width:0%;
        background: linear-gradient(135deg, rgba(124,88,255,0.95), rgba(0,225,255,0.75));
        transition: width .35s ease;
      }
      .progMetaLine{
        margin-top:6px;
        font-size:11px;
        color:var(--muted2);
        font-family:var(--mono);
      }

      .rowClick{ cursor:pointer; }
      .rowClick:hover{ background: rgba(124,88,255,0.06); }

      /* Toast */
      .toast{
        position:fixed;
        right:16px;
        bottom:16px;
        width:min(420px, calc(100% - 32px));
        display:flex;
        flex-direction:column;
        gap:10px;
        z-index:9999;
      }
      .toastItem{
        padding:12px 12px;
        border-radius: 16px;
        border:1px solid rgba(255,255,255,0.08);
        background: rgba(10,10,16,0.78);
        backdrop-filter: blur(10px);
        box-shadow: 0 18px 50px rgba(0,0,0,0.5);
      }
      .toastItem.ok{ border-color: rgba(108,255,179,0.18); }
      .toastItem.err{ border-color: rgba(255,108,122,0.22); }
      .toastItem .tTitle{ font-weight:900; font-size:12px; margin:0 0 6px; }
      .toastItem .tBody{ color:var(--muted); font-size:12px; line-height:1.45; font-family:var(--mono); }

      .ok{ color:var(--good); }
      .warn{ color:var(--warn); }
      .err{ color:var(--bad); }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="hero card">
        <div class="heroRow">
          <div class="brand">
            <div class="logo"></div>
            <div>
              <h1>Coin Memory</h1>
              <div class="subtitle">Quest-driven coin dashboard. Wallets become characters. Badges = proof.</div>
            </div>
          </div>

          <div class="chips">
            <div class="chip"><span id="statusDot" class="dot"></span> <b id="status">loading</b></div>
            <div class="chip">raw <b id="rawCount">-</b></div>
            <div class="chip">buys <b id="buyCount">-</b></div>
            <div class="chip">mint <span class="mono" id="targetMint">null</span></div>
            <button class="btn" id="refreshBtn">Refresh</button>
          </div>
        </div>

        <div class="subtitle" style="margin-top:10px">
          Creator: <span class="mono" id="creatorWallet">—</span> · <span id="lastUpdated"></span>
        </div>
        <div class="subtitle mono" style="margin-top:8px" id="panelHealth"></div>
      </div>

      <div class="card">
        <div class="cardHead">
          <h2>Quest of the Hour</h2>
          <div class="tag" id="questCountdown">loading…</div>
        </div>
        <div class="cardBody">
          <div class="tag" style="display:inline-block">claims: <span id="questClaimsCount">-</span></div>
          <div style="font-size:22px; font-weight:900; margin-top:10px" id="questTitle">—</div>
          <div class="subtitle" style="margin-top:6px" id="questRule">—</div>

          <div class="badgeWrap" id="questBadgeWrap"></div>

          <div style="display:grid; grid-template-columns: 1fr 1fr auto; gap:10px; margin-top:14px">
            <input id="claimWallet" placeholder="wallet address (base58)" />
            <input id="claimSig" placeholder="tx signature" />
            <button class="btn" id="claimBtn">CLAIM</button>
          </div>

          <div class="subtitle" style="margin-top:10px">
            Claims require the signature to exist in <span class="mono">raw_events</span> (ingested via webhook).
          </div>

          <div class="card" style="margin-top:14px">
            <div class="cardHead">
              <h2>Recent Claims</h2>
              <div class="tag" id="claimsMeta">(0)</div>
            </div>
            <div class="cardBody" style="padding:0">
              <table>
                <thead><tr><th>Rank</th><th>Wallet</th><th>Signature</th><th>Time</th></tr></thead>
                <tbody id="claims"></tbody>
              </table>
              <div id="claimsEmpty" class="subtitle" style="padding:12px; display:none">No claims yet this hour.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="grid grid2">
        <div class="card">
          <div class="cardHead">
            <h2>Coin Memory</h2>
            <div class="tag">actors <span id="actorsMeta">(0)</span></div>
          </div>
          <div class="cardBody" style="padding:0">
            <table>
              <thead><tr><th>Wallet</th><th>Vibe</th><th>Badges</th><th>Interactions</th><th>SOL out</th></tr></thead>
              <tbody id="actors"></tbody>
            </table>
            <div id="actorsEmpty" class="subtitle" style="padding:12px; display:none">No actors yet.</div>
          </div>
        </div>

        <div class="card">
          <div class="cardHead">
            <h2>Selected Wallet</h2>
            <div class="tag" id="walletMeta">click an actor</div>
          </div>
          <div class="cardBody">
            <div class="badgeWrap" id="walletBadges"></div>

            <div class="card" style="margin-top:12px">
              <div class="cardHead">
                <h2>Badge Progress</h2>
                <div class="tag" id="progressMeta">—</div>
              </div>
              <div class="cardBody" id="progressBox"></div>
            </div>

            <div class="card" style="margin-top:12px">
              <div class="cardHead">
                <h2>Timeline</h2>
                <div class="tag">last 40</div>
              </div>
              <div class="cardBody" style="padding:0">
                <table>
                  <thead><tr><th>Time</th><th>Kind</th><th>Amount</th><th>Other</th><th>Sig</th></tr></thead>
                  <tbody id="walletEvents"></tbody>
                </table>
                <div id="walletEmpty" class="subtitle" style="padding:12px; display:block">No wallet selected.</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="grid grid3">
        <div class="card">
          <div class="cardHead"><h2>Latest Activity</h2><div class="tag">ingest</div></div>
          <div class="cardBody" style="padding:0">
            <table><thead><tr><th>Signature</th><th>Block time</th></tr></thead><tbody id="latest"></tbody></table>
            <div id="latestEmpty" class="subtitle" style="padding:12px; display:none">No raw events.</div>
          </div>
        </div>

        <div class="card">
          <div class="cardHead"><h2>Mint Discovery</h2><div class="tag">top mints</div></div>
          <div class="cardBody" style="padding:0">
            <table><thead><tr><th>Mint</th><th>Count</th></tr></thead><tbody id="mints"></tbody></table>
            <div id="mintsEmpty" class="subtitle" style="padding:12px; display:none">No mints.</div>
          </div>
        </div>

        <div class="card">
          <div class="cardHead"><h2>Buyers</h2><div class="tag">after launch</div></div>
          <div class="cardBody" style="padding:0">
            <table><thead><tr><th>Buyer</th><th>Token</th><th>SOL</th><th>Sig</th></tr></thead><tbody id="buyers"></tbody></table>
            <div id="buyersEmpty" class="subtitle" style="padding:12px; display:none">No buyers.</div>
          </div>
        </div>
      </div>
    </div>

    <div class="toast" id="toast"></div>
    <script src="/app.js"></script>
  </body>
</html>
